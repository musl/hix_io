#!/usr/bin/env ruby
# vim: set nosta noet ts=4 sw=4 ft=ruby:
# encoding: UTF-8

require 'hix_io'
require 'trollop'

opts = Trollop.options do
	banner 'HixIO Migration Tool'
	opt :config, 'Required: The path to the HixIO config.', :type => :string, :required => true
	opt :debug, 'Force debug logging.', :default => false
	opt :target, 'Migration target. Omit to migrate to the latest available migration.', :default => nil, :type => :int
end

HixIO.load_config( opts[:config], :skip_models => true )
if apts[:debug]
	HixIO.log.level = :debug
end

Sequel.extension :migration

klass = Sequel::Migrator.migrator_class( HixIO::MIGRATION_DIR )

migrator = klass.new( HixIO.db, HixIO::MIGRATION_DIR, :target => opts[:target] )
migrator.run

migrator = klass.new( HixIO.db, HixIO::MIGRATION_DIR )
HixIO.log.info "At version %d." % [migrator.current]

